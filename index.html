<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock Management</title>
<style>
body{margin:0;font-family:'Segoe UI',Arial;background:#f4f6f8}
header{background:#1f3c88;color:#fff;padding:16px;display:flex;justify-content:space-between;align-items:center}
.lang-btn{background:#fff;color:#1f3c88;border:none;border-radius:20px;padding:6px 14px;font-weight:bold;cursor:pointer}
.container{max-width:1200px;margin:20px auto;background:#fff;border-radius:10px;padding:20px}
.tabs{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
.tab{padding:8px 14px;border-radius:18px;background:#e0e6ff;cursor:pointer}
.tab.active{background:#1f3c88;color:#fff}
.toolbar{display:flex;align-items:center;gap:14px;margin-bottom:12px}
.search{padding:8px 12px;flex:1;border:1px solid #ccc;border-radius:6px;min-width:160px}
.save{background:#4caf50;color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer}
.save:disabled{background:#9e9e9e}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#eef2ff}
input.qty{width:70px;text-align:center}
tr.warn{background:#ffe6e6}
.bubble{position:fixed;bottom:20px;right:20px;background:#d32f2f;color:#fff;padding:10px 14px;border-radius:8px;opacity:0;transition:.3s}
.bubble.show{opacity:1}
</style>
</head>
<body>

<header>
  <h2 id="title">ðŸ“¦ Stock Management</h2>
  <div style="display:flex;gap:10px;align-items:center">
    <button class="lang-btn" onclick="openLog()" id="logBtn">Log</button>
    <button class="lang-btn" id="langBtn" onclick="toggleLang()">EN</button>
  </div>
</header>

<div class="container">
  <div class="tabs">
    <div class="tab" onclick="switchTab('Motor',this)">Motor</div>
    <div class="tab" onclick="switchTab('GearHead',this)">GearHead</div>
    <div class="tab" onclick="switchTab('SpeedController',this)">Speed Controller</div>
    <div class="tab" onclick="switchTab('Glass',this)">Glass</div>
    <div class="tab" onclick="switchTab('Inverter',this)">Inverter</div>
    <div class="tab" onclick="switchTab('Shaft',this)">Shaft</div>
  </div>

  <div class="toolbar">
    <input class="search" id="search" placeholder="Search..." onkeyup="searchTable()">
    <button id="saveBtn" class="save" onclick="saveData()" disabled>Save</button>
  </div>

  <table>
    <thead>
      <tr>
        <th id="colItem">Item</th>
        <th id="colStock">Stock</th>
        <th id="colUsed">Used</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div id="logView" style="display:none;margin-top:20px">
    <h3>ðŸ“œ Save History</h3>
    <table>
      <thead>
        <tr>
          <th>Time</th><th>Type</th><th>Item</th>
          <th>Stock</th><th>Used</th>
        </tr>
      </thead>
      <tbody id="logBody"></tbody>
    </table>
  </div>
</div>

<div class="bubble" id="bubble"></div>

<script>
/* ---------- Language ---------- */
let lang = localStorage.getItem("lang") || "en";
const text={
  en:{title:"ðŸ“¦ Stock Management",search:"Search...",save:"Save",item:"Item",stock:"Stock",used:"Used"},
  kr:{title:"ðŸ“¦ ìž¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ",search:"ê²€ìƒ‰...",save:"ì €ìž¥",item:"í’ˆëª…",stock:"ìž¬ê³ ìˆ˜ëŸ‰",used:"ì‚¬ìš©ìˆ˜ëŸ‰"}
};
function applyLang(){
  const t=text[lang];
  title.innerText=t.title;
  search.placeholder=t.search;
  saveBtn.innerText=t.save;
  colItem.innerText=t.item;
  colStock.innerText=t.stock;
  colUsed.innerText=t.used;
  langBtn.innerText=lang.toUpperCase();
}
function toggleLang(){
  lang=lang==="en"?"kr":"en";
  localStorage.setItem("lang",lang);
  applyLang();
}

/* ---------- Data ---------- */
const defaultData = {
  Motor:[["HF-KP43G1",2,0]],
  GearHead:[],SpeedController:[],Glass:[],Inverter:[],
  Shaft:[["10Ã˜ 55 M5-N5",4,0]]
};
let data = JSON.parse(localStorage.getItem("stockData")) || defaultData;
for(const k in defaultData){ if(!data[k]) data[k]=[]; }

let currentTab="Motor";
let snapshot=JSON.stringify(data);

/* ---------- Render ---------- */
function render(){
  tbody.innerHTML="";
  (data[currentTab]||[]).forEach((r,i)=>{
    const warn=r[2]>r[1]?"warn":"";
    tbody.innerHTML+=`<tr class="${warn}">
      <td>${r[0]}</td>
      <td><input class="qty" type="number" min="0" value="${r[1]}" onchange="updateQty(${i},1,this.value)"></td>
      <td><input class="qty" type="number" min="0" value="${r[2]}" onchange="updateQty(${i},2,this.value)"></td>
    </tr>`;
  });
  applySearch();
}
function switchTab(t,el){
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
  if(el) el.classList.add("active");
  currentTab=t;
  logView.style.display="none";
  document.querySelector("table").style.display="table";
  document.querySelector(".toolbar").style.display="flex";
  render();
}

/* ---------- Edit ---------- */
function updateQty(i,c,v){
  let n=Number(v); if(n<0)n=0;
  data[currentTab][i][c]=n;
  saveBtn.disabled=JSON.stringify(data)===snapshot;
  if(data[currentTab][i][2]>data[currentTab][i][1]) showBubble();
}
function showBubble(){
  bubble.innerText=lang==="en"?"Used exceeds stock":"ì‚¬ìš©ìˆ˜ëŸ‰ì´ ìž¬ê³ ë³´ë‹¤ ë§ŽìŠµë‹ˆë‹¤";
  bubble.classList.add("show");
  setTimeout(()=>bubble.classList.remove("show"),2000);
}

/* ---------- Search ---------- */
let currentSearch="";
function searchTable(){ currentSearch=search.value.toUpperCase(); applySearch(); }
function applySearch(){
  document.querySelectorAll("#tbody tr").forEach(r=>{
    r.style.display=r.innerText.toUpperCase().includes(currentSearch)?"":"none";
  });
}

/* ---------- Save & Log ---------- */
let logs=JSON.parse(localStorage.getItem("stockLogs")||"[]");
function saveData(){
  logs.push({time:new Date().toISOString(),data:JSON.parse(JSON.stringify(data))});
  localStorage.setItem("stockData",JSON.stringify(data));
  localStorage.setItem("stockLogs",JSON.stringify(logs));
  snapshot=JSON.stringify(data);
  saveBtn.disabled=true;
  alert(lang==="en"?"Saved":"ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤");
}
function openLog(){
  document.querySelector(".toolbar").style.display="none";
  document.querySelector("table").style.display="none";
  logView.style.display="block";
  logBody.innerHTML="";
  logs.slice().reverse().forEach(l=>{
    logBody.innerHTML+=`<tr><td>${new Date(l.time).toLocaleString()}</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>`;
  });
}

/* ---------- Init ---------- */
applyLang();
switchTab("Motor",document.querySelector(".tab"));
</script>

</body>
</html>
